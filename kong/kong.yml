_format_version: "3.0"

############################
# SERVICES & ROUTES
############################
services:
  - name: auth-service
    url: http://auth-service:8081
    routes:
      - name: auth-routes
        paths:
          - /auth
        strip_path: false

  - name: user-service
    url: http://user-service:8082
    routes:
      - name: user-routes
        paths:
          - /users
        strip_path: false

  - name: vehicle-service
    url: http://vehicle-service:8083
    routes:
      - name: vehicle-routes
        paths:
          - /vehicles
        strip_path: false

############################
# CONSUMERS + JWT (DB-LESS)
############################
consumers:
  - username: auth-service
    jwt_secrets:
      - key: auth-service          # MUST match JWT `iss`
        algorithm: HS256
        secret: THIS_IS_A_256_BIT_SECRET_KEY_FOR_JWT_SIGNING_123456

############################
# PLUGINS
############################
plugins:
  - name: jwt
    service: user-service
    config:
      key_claim_name: iss
      claims_to_verify:
        - exp

  - name: jwt
    service: vehicle-service
    config:
      key_claim_name: iss
      claims_to_verify:
        - exp
